{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/app/patient/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Button from \"@/components/Button\";\r\nimport Link from \"next/link\";\r\n\r\ntype AuthUser = {\r\n  id: string;\r\n  role: \"patient\" | \"doctor\";\r\n  full_name: string;\r\n  email: string;\r\n  phone?: string;\r\n};\r\n\r\ntype Appointment = {\r\n  _id: string;\r\n  date: string;\r\n  time: string;\r\n  status: string;\r\n  doctor_id?: {\r\n    full_name: string;\r\n    specializations?: string[];\r\n  };\r\n};\r\n\r\nexport default function PatientDashboardPage() {\r\n  const router = useRouter();\r\n\r\n  const [user, setUser] = useState<AuthUser | null>(null);\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchAppointments = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const response = await fetch(\"/api/appointments/book\", {\r\n        method: \"GET\",\r\n        credentials: \"include\",\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (response.ok && data.success) {\r\n        setAppointments(data.appointments || []);\r\n      } else {\r\n        console.error(\r\n          \"Error fetching appointments:\",\r\n          data.error || data.message\r\n        );\r\n        setError(data.error || data.message || \"Failed to load appointments.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching appointments:\", error);\r\n      setError(\"Failed to load appointments.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    async function init() {\r\n      try {\r\n        const res = await fetch(\"/api/auth/me\", {\r\n          method: \"GET\",\r\n          credentials: \"include\",\r\n        });\r\n\r\n        if (res.status === 401) {\r\n          if (!cancelled) router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n\r\n        if (!data.success || data.user.role !== \"patient\") {\r\n          if (!cancelled) router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        if (!cancelled) {\r\n          setUser(data.user);\r\n          await fetchAppointments();\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error loading dashboard:\", error);\r\n        if (!cancelled) {\r\n          setError(\"Something went wrong loading your dashboard.\");\r\n          setLoading(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    init();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [router]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <main className=\"site-container py-10\">\r\n        <div className=\"card\">\r\n          <p>Loading your dashboard...</p>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <main className=\"site-container py-10\">\r\n        <div className=\"card\">\r\n          <h2 className=\"mb-2\">Something went wrong</h2>\r\n          <p className=\"mb-4 text-sm text-red-600\">{error}</p>\r\n          <Button variant=\"secondary\" onClick={() => router.refresh()}>\r\n            Try again\r\n          </Button>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    // we already redirected in effect – just render nothing\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <main className=\"site-container py-10\">\r\n      {/* Header section */}\r\n      <section className=\"mb-6\">\r\n        <h1 className=\"mb-1\">Welcome back, {user.full_name}</h1>\r\n        <p className=\"text-sm text-slate-500\">\r\n          Manage your appointments and keep track of your visits.\r\n        </p>\r\n      </section>\r\n\r\n      {/* Appointments section */}\r\n      <section className=\"card\">\r\n        <div className=\"flex items-center justify-between mb-4 gap-2\">\r\n          <h2 className=\"text-lg font-semibold\">Your appointments</h2>\r\n          <Link href=\"/clinics\">\r\n            <Button variant=\"primary\" size=\"sm\">\r\n              Book new appointment\r\n            </Button>\r\n          </Link>\r\n        </div>\r\n\r\n        {appointments.length === 0 ? (\r\n          <p className=\"text-sm text-slate-500\">\r\n            You don’t have any appointments yet.{\" \"}\r\n            <Link href=\"/clinics\" className=\"text-indigo-600 underline\">\r\n              Find a clinic\r\n            </Link>{\" \"}\r\n            to book your first visit.\r\n          </p>\r\n        ) : (\r\n          <div className=\"table-wrapper\">\r\n            <table className=\"table-root\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Date</th>\r\n                  <th>Time</th>\r\n                  <th>Doctor</th>\r\n                  <th>Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {appointments.map((appt) => (\r\n                  <tr key={appt._id}>\r\n                    <td>{appt.date}</td>\r\n                    <td>{appt.time}</td>\r\n                    <td>{appt.doctor_id?.full_name ?? \"—\"}</td>\r\n                    <td className=\"capitalize\">{appt.status}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}