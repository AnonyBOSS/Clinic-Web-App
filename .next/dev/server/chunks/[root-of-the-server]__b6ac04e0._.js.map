{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/lib/db/connection.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/clinics-booking';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\nlet cached = global as any;\r\n\r\nif (!cached.mongoose) {\r\n  cached.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectDB() {\r\n  if (cached.mongoose.conn) {\r\n    return cached.mongoose.conn;\r\n  }\r\n\r\n  if (!cached.mongoose.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.mongoose.promise = mongoose\r\n      .connect(MONGODB_URI, opts)\r\n      .then((mongoose) => {\r\n        return mongoose;\r\n      });\r\n  }\r\n\r\n  try {\r\n    cached.mongoose.conn = await cached.mongoose.promise;\r\n  } catch (e) {\r\n    cached.mongoose.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.mongoose.conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI;AAEJ,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAChD;AAEO,eAAe;IACpB,IAAI,OAAO,QAAQ,CAAC,IAAI,EAAE;QACxB,OAAO,OAAO,QAAQ,CAAC,IAAI;IAC7B;IAEA,IAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,EAAE;QAC5B,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,QAAQ,CAAC,OAAO,GAAG,oHAAQ,CAC/B,OAAO,CAAC,aAAa,MACrB,IAAI,CAAC,CAAC;YACL,OAAO;QACT;IACJ;IAEA,IAAI;QACF,OAAO,QAAQ,CAAC,IAAI,GAAG,MAAM,OAAO,QAAQ,CAAC,OAAO;IACtD,EAAE,OAAO,GAAG;QACV,OAAO,QAAQ,CAAC,OAAO,GAAG;QAC1B,MAAM;IACR;IAEA,OAAO,OAAO,QAAQ,CAAC,IAAI;AAC7B"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/models/Doctor.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport interface IDoctor extends Document {\r\n  full_name: string;\r\n  phone: string;\r\n  email: string;\r\n  password: string;\r\n  qualifications?: string[];\r\n  specializations: string[];\r\n  clinic_affiliations: mongoose.Types.ObjectId[];\r\n  schedule_days?: {\r\n    day: string;\r\n    start_time: string;\r\n    end_time: string;\r\n  }[];\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  comparePassword(password: string): Promise<boolean>;\r\n}\r\n\r\nconst DoctorSchema = new Schema<IDoctor>(\r\n  {\r\n    full_name: {\r\n      type: String,\r\n      required: [true, 'Please provide a full name'],\r\n    },\r\n    phone: {\r\n      type: String,\r\n    },\r\n    email: {\r\n      type: String,\r\n      required: [true, 'Please provide an email'],\r\n      unique: true,\r\n      lowercase: true,\r\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please provide a valid email'],\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: [true, 'Please provide a password'],\r\n      minlength: 6,\r\n      select: false,\r\n    },\r\n    qualifications: [String],\r\n    specializations: {\r\n      type: [String],\r\n      default: [],\r\n    },\r\n    clinic_affiliations: [\r\n      {\r\n        type: Schema.Types.ObjectId,\r\n        ref: 'Clinic',\r\n      },\r\n    ],\r\n    schedule_days: [\r\n      {\r\n        day: String,\r\n        start_time: String,\r\n        end_time: String,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n);\r\n\r\n// Hash password before saving\r\nDoctorSchema.pre('save', async function (this: IDoctor, next: any) {\r\n  if (!this.isModified('password')) {\r\n    return;\r\n  }\r\n  const salt = await bcrypt.genSalt(10);\r\n  this.password = await bcrypt.hash(this.password, salt);\r\n});\r\n\r\n// Method to compare password\r\nDoctorSchema.methods.comparePassword = async function (enteredPassword: string) {\r\n  return await bcrypt.compare(enteredPassword, this.password);\r\n};\r\n\r\nexport default mongoose.models.Doctor || mongoose.model<IDoctor>('Doctor', DoctorSchema);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoBA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;IAChD;IACA,OAAO;QACL,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,OAAO;YAAC;YAAiD;SAA+B;IAC1F;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;QACX,QAAQ;IACV;IACA,gBAAgB;QAAC;KAAO;IACxB,iBAAiB;QACf,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,qBAAqB;QACnB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,eAAe;QACb;YACE,KAAK;YACL,YAAY;YACZ,UAAU;QACZ;KACD;AACH,GACA;IACE,YAAY;AACd;AAGF,8BAA8B;AAC9B,aAAa,GAAG,CAAC,QAAQ,eAA+B,IAAS;IAC/D,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IACA,MAAM,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,oLAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;AACnD;AAEA,6BAA6B;AAC7B,aAAa,OAAO,CAAC,eAAe,GAAG,eAAgB,eAAuB;IAC5E,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC,iBAAiB,IAAI,CAAC,QAAQ;AAC5D;uCAEe,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/models/Appointment.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface IAppointment extends Document {\r\n  patient_id: mongoose.Types.ObjectId;\r\n  doctor_id: mongoose.Types.ObjectId;\r\n  clinic_id: mongoose.Types.ObjectId;\r\n  room_id: mongoose.Types.ObjectId;\r\n  slot_id: mongoose.Types.ObjectId;\r\n  status: 'booked' | 'confirmed' | 'cancelled' | 'completed';\r\n  notes?: string;\r\n  payment: {\r\n    amount: number;\r\n    method: 'cash' | 'card';\r\n    transaction_id?: string;\r\n    status: 'pending' | 'paid' | 'refunded' | 'failed';\r\n    timestamp: Date;\r\n  };\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst AppointmentSchema = new Schema<IAppointment>(\r\n  {\r\n    patient_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Patient',\r\n      required: true,\r\n    },\r\n    doctor_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Doctor',\r\n      required: true,\r\n    },\r\n    clinic_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Clinic',\r\n      required: true,\r\n    },\r\n    room_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Room',\r\n      required: true,\r\n    },\r\n    slot_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Slot',\r\n      required: true,\r\n      unique: true,\r\n    },\r\n    status: {\r\n      type: String,\r\n      enum: ['booked', 'confirmed', 'cancelled', 'completed'],\r\n      default: 'booked',\r\n    },\r\n    notes: String,\r\n    payment: {\r\n      amount: {\r\n        type: Number,\r\n        required: true,\r\n      },\r\n      method: {\r\n        type: String,\r\n        enum: ['cash', 'card'],\r\n        required: true,\r\n      },\r\n      transaction_id: String,\r\n      status: {\r\n        type: String,\r\n        enum: ['pending', 'paid', 'refunded', 'failed'],\r\n        default: 'pending',\r\n      },\r\n      timestamp: {\r\n        type: Date,\r\n        default: Date.now,\r\n      },\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n);\r\n\r\n// Create indexes for faster queries\r\nAppointmentSchema.index({ doctor_id: 1, createdAt: -1 });\r\nAppointmentSchema.index({ patient_id: 1, createdAt: -1 });\r\n\r\nexport default mongoose.models.Appointment || mongoose.model<IAppointment>('Appointment', AppointmentSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAqBA,MAAM,oBAAoB,IAAI,mHAAM,CAClC;IACE,YAAY;QACV,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;IACV;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAU;YAAa;YAAa;SAAY;QACvD,SAAS;IACX;IACA,OAAO;IACP,SAAS;QACP,QAAQ;YACN,MAAM;YACN,UAAU;QACZ;QACA,QAAQ;YACN,MAAM;YACN,MAAM;gBAAC;gBAAQ;aAAO;YACtB,UAAU;QACZ;QACA,gBAAgB;QAChB,QAAQ;YACN,MAAM;YACN,MAAM;gBAAC;gBAAW;gBAAQ;gBAAY;aAAS;YAC/C,SAAS;QACX;QACA,WAAW;YACT,MAAM;YACN,SAAS,KAAK,GAAG;QACnB;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,oCAAoC;AACpC,kBAAkB,KAAK,CAAC;IAAE,WAAW;IAAG,WAAW,CAAC;AAAE;AACtD,kBAAkB,KAAK,CAAC;IAAE,YAAY;IAAG,WAAW,CAAC;AAAE;uCAExC,oHAAQ,CAAC,MAAM,CAAC,WAAW,IAAI,oHAAQ,CAAC,KAAK,CAAe,eAAe"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/app/api/doctors/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { connectDB } from '@/lib/db/connection';\r\nimport Doctor from '@/models/Doctor';\r\nimport Appointment from '@/models/Appointment';\r\nimport Patient from '@/models/Patient';\r\nimport Clinic from '@/models/Clinic';\r\nimport Room from '@/models/Room';\r\n\r\nexport async function GET(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    await connectDB();\r\n    const { searchParams } = new URL(req.url);\r\n    const date = searchParams.get('date');\r\n\r\n    const doctor = await Doctor.findById(id)\r\n      .populate('clinic_affiliations')\r\n      .lean();\r\n\r\n    if (!doctor) {\r\n      return NextResponse.json(\r\n        { error: 'Doctor not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    let appointments: any[] = [];\r\n\r\n    if (date) {\r\n      const startDate = new Date(date);\r\n      const endDate = new Date(date);\r\n      endDate.setDate(endDate.getDate() + 1);\r\n\r\n      appointments = await Appointment.find({\r\n        doctor_id: id,\r\n        createdAt: { $gte: startDate, $lt: endDate },\r\n      })\r\n        .populate('patient_id', 'full_name')\r\n        .populate('clinic_id', 'name')\r\n        .populate('room_id', 'room_number')\r\n        .lean();\r\n    }\r\n\r\n    return NextResponse.json(\r\n      {\r\n        doctor,\r\n        schedule: doctor.schedule_days || [],\r\n        appointments,\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    console.error('Error fetching doctor schedule:', error);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    await connectDB();\r\n    const data = await req.json();\r\n    const doctor = await Doctor.findByIdAndUpdate(id, data, { new: true });\r\n\r\n    if (!doctor) {\r\n      return NextResponse.json(\r\n        { error: 'Doctor not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(doctor, { status: 200 });\r\n  } catch (error) {\r\n    console.error('Error updating doctor:', error);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAKO,eAAe,IACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,IAAA,4KAAS;QACf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,MAAM,SAAS,MAAM,mKAAM,CAAC,QAAQ,CAAC,IAClC,QAAQ,CAAC,uBACT,IAAI;QAEP,IAAI,CAAC,QAAQ;YACX,OAAO,sLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmB,GAC5B;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,eAAsB,EAAE;QAE5B,IAAI,MAAM;YACR,MAAM,YAAY,IAAI,KAAK;YAC3B,MAAM,UAAU,IAAI,KAAK;YACzB,QAAQ,OAAO,CAAC,QAAQ,OAAO,KAAK;YAEpC,eAAe,MAAM,wKAAW,CAAC,IAAI,CAAC;gBACpC,WAAW;gBACX,WAAW;oBAAE,MAAM;oBAAW,KAAK;gBAAQ;YAC7C,GACG,QAAQ,CAAC,cAAc,aACvB,QAAQ,CAAC,aAAa,QACtB,QAAQ,CAAC,WAAW,eACpB,IAAI;QACT;QAEA,OAAO,sLAAY,CAAC,IAAI,CACtB;YACE;YACA,UAAU,OAAO,aAAa,IAAI,EAAE;YACpC;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,IAAA,4KAAS;QACf,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS,MAAM,mKAAM,CAAC,iBAAiB,CAAC,IAAI,MAAM;YAAE,KAAK;QAAK;QAEpE,IAAI,CAAC,QAAQ;YACX,OAAO,sLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmB,GAC5B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,sLAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}