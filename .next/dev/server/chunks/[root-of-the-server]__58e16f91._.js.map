{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/lib/auth.ts"],"sourcesContent":["import jwt, { SignOptions } from 'jsonwebtoken';\r\n\r\nexport interface TokenPayload {\r\n  id: string;\r\n  email: string;\r\n  role: 'patient' | 'doctor';\r\n}\r\n\r\n// Load env secret with type safety\r\nconst secret = process.env.JWT_SECRET;\r\nif (!secret) {\r\n  throw new Error('JWT_SECRET is not set. Please define it in your environment variables.');\r\n}\r\n\r\nconst JWT_SECRET: string = secret;\r\n\r\nexport function generateToken(\r\n  payload: TokenPayload,\r\n  expiresIn: SignOptions['expiresIn'] = '30d'\r\n): string {\r\n  const options: SignOptions = { expiresIn };\r\n  return jwt.sign(payload, JWT_SECRET, options);\r\n}\r\n\r\nexport function verifyToken(token: string): TokenPayload | null {\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_SECRET) as TokenPayload;\r\n    return decoded;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function extractToken(authHeader: string | null): string | null {\r\n  if (!authHeader) return null;\r\n  const parts = authHeader.split(' ');\r\n  if (parts.length === 2 && parts[0] === 'Bearer') return parts[1];\r\n  return null;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAQA,mCAAmC;AACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AACrC,IAAI,CAAC,QAAQ;IACX,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,aAAqB;AAEpB,SAAS,cACd,OAAqB,EACrB,YAAsC,KAAK;IAE3C,MAAM,UAAuB;QAAE;IAAU;IACzC,OAAO,wLAAG,CAAC,IAAI,CAAC,SAAS,YAAY;AACvC;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,wLAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,aAAa,UAAyB;IACpD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO,KAAK,CAAC,EAAE;IAChE,OAAO;AACT"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/lib/auth-request.ts"],"sourcesContent":["import type { NextRequest } from 'next/server';\r\nimport { verifyToken, extractToken } from './auth';\r\n\r\nexport type AuthUser = {\r\n  id: string;\r\n  email: string;\r\n  role: 'patient' | 'doctor';\r\n};\r\n\r\nexport function getAuthUserFromRequest(req: NextRequest): AuthUser | null {\r\n  // 1) Try cookie first\r\n  let token = req.cookies.get('auth_token')?.value ?? null;\r\n\r\n  // 2) If no cookie, fall back to Authorization header\r\n  if (!token) {\r\n    const authHeader = req.headers.get('authorization');\r\n    token = extractToken(authHeader);\r\n  }\r\n\r\n  if (!token) return null;\r\n\r\n  const payload = verifyToken(token);\r\n  if (!payload) return null;\r\n\r\n  return payload;\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAQO,SAAS,uBAAuB,GAAgB;IACrD,sBAAsB;IACtB,IAAI,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,SAAS;IAEpD,qDAAqD;IACrD,IAAI,CAAC,OAAO;QACV,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,QAAQ,IAAA,mKAAY,EAAC;IACvB;IAEA,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU,IAAA,kKAAW,EAAC;IAC5B,IAAI,CAAC,SAAS,OAAO;IAErB,OAAO;AACT"}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/lib/db/connection.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/clinics-booking';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\nlet cached = global as any;\r\n\r\nif (!cached.mongoose) {\r\n  cached.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectDB() {\r\n  if (cached.mongoose.conn) {\r\n    return cached.mongoose.conn;\r\n  }\r\n\r\n  if (!cached.mongoose.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.mongoose.promise = mongoose\r\n      .connect(MONGODB_URI, opts)\r\n      .then((mongoose) => {\r\n        return mongoose;\r\n      });\r\n  }\r\n\r\n  try {\r\n    cached.mongoose.conn = await cached.mongoose.promise;\r\n  } catch (e) {\r\n    cached.mongoose.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.mongoose.conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI;AAEJ,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAChD;AAEO,eAAe;IACpB,IAAI,OAAO,QAAQ,CAAC,IAAI,EAAE;QACxB,OAAO,OAAO,QAAQ,CAAC,IAAI;IAC7B;IAEA,IAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,EAAE;QAC5B,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,QAAQ,CAAC,OAAO,GAAG,oHAAQ,CAC/B,OAAO,CAAC,aAAa,MACrB,IAAI,CAAC,CAAC;YACL,OAAO;QACT;IACJ;IAEA,IAAI;QACF,OAAO,QAAQ,CAAC,IAAI,GAAG,MAAM,OAAO,QAAQ,CAAC,OAAO;IACtD,EAAE,OAAO,GAAG;QACV,OAAO,QAAQ,CAAC,OAAO,GAAG;QAC1B,MAAM;IACR;IAEA,OAAO,OAAO,QAAQ,CAAC,IAAI;AAC7B"}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/models/Patient.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport interface IPatient extends Document {\r\n  full_name: string;\r\n  phone: string;\r\n  email: string;\r\n  password: string;\r\n  insurance_info?: string;\r\n  medical_summary?: string;\r\n  emergency_contact?: {\r\n    name: string;\r\n    phone: string;\r\n    relation: string;\r\n  };\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  comparePassword(password: string): Promise<boolean>;\r\n}\r\n\r\nconst PatientSchema = new Schema<IPatient>(\r\n  {\r\n    full_name: {\r\n      type: String,\r\n      required: [true, 'Please provide a full name'],\r\n    },\r\n    phone: {\r\n      type: String,\r\n      required: [true, 'Please provide a phone number'],\r\n    },\r\n    email: {\r\n      type: String,\r\n      required: [true, 'Please provide an email'],\r\n      unique: true,\r\n      lowercase: true,\r\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please provide a valid email'],\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: [true, 'Please provide a password'],\r\n      minlength: 6,\r\n      select: false,\r\n    },\r\n    insurance_info: {\r\n      type: String,\r\n    },\r\n    medical_summary: {\r\n      type: String,\r\n    },\r\n    emergency_contact: {\r\n      name: String,\r\n      phone: String,\r\n      relation: String,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n);\r\n\r\n// Hash password before saving\r\nPatientSchema.pre('save', async function (this: IPatient, next: any) {\r\n  if (!this.isModified('password')) {\r\n    return;\r\n  }\r\n  const salt = await bcrypt.genSalt(10);\r\n  this.password = await bcrypt.hash(this.password, salt);\r\n});\r\n\r\n// Method to compare password\r\nPatientSchema.methods.comparePassword = async function (enteredPassword: string) {\r\n  return await bcrypt.compare(enteredPassword, this.password);\r\n};\r\n\r\nexport default mongoose.models.Patient || mongoose.model<IPatient>('Patient', PatientSchema);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAmBA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;IAChD;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAAgC;IACnD;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,OAAO;YAAC;YAAiD;SAA+B;IAC1F;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;QACX,QAAQ;IACV;IACA,gBAAgB;QACd,MAAM;IACR;IACA,iBAAiB;QACf,MAAM;IACR;IACA,mBAAmB;QACjB,MAAM;QACN,OAAO;QACP,UAAU;IACZ;AACF,GACA;IACE,YAAY;AACd;AAGF,8BAA8B;AAC9B,cAAc,GAAG,CAAC,QAAQ,eAAgC,IAAS;IACjE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IACA,MAAM,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,oLAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;AACnD;AAEA,6BAA6B;AAC7B,cAAc,OAAO,CAAC,eAAe,GAAG,eAAgB,eAAuB;IAC7E,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC,iBAAiB,IAAI,CAAC,QAAQ;AAC5D;uCAEe,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/models/Doctor.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport interface IDoctor extends Document {\r\n  full_name: string;\r\n  phone: string;\r\n  email: string;\r\n  password: string;\r\n  qualifications?: string[];\r\n  specializations: string[];\r\n  clinic_affiliations: mongoose.Types.ObjectId[];\r\n  schedule_days?: {\r\n    day: string;\r\n    start_time: string;\r\n    end_time: string;\r\n  }[];\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  comparePassword(password: string): Promise<boolean>;\r\n}\r\n\r\nconst DoctorSchema = new Schema<IDoctor>(\r\n  {\r\n    full_name: {\r\n      type: String,\r\n      required: [true, 'Please provide a full name'],\r\n    },\r\n    phone: {\r\n      type: String,\r\n    },\r\n    email: {\r\n      type: String,\r\n      required: [true, 'Please provide an email'],\r\n      unique: true,\r\n      lowercase: true,\r\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please provide a valid email'],\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: [true, 'Please provide a password'],\r\n      minlength: 6,\r\n      select: false,\r\n    },\r\n    qualifications: [String],\r\n    specializations: {\r\n      type: [String],\r\n      default: [],\r\n    },\r\n    clinic_affiliations: [\r\n      {\r\n        type: Schema.Types.ObjectId,\r\n        ref: 'Clinic',\r\n      },\r\n    ],\r\n    schedule_days: [\r\n      {\r\n        day: String,\r\n        start_time: String,\r\n        end_time: String,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n);\r\n\r\n// Hash password before saving\r\nDoctorSchema.pre('save', async function (this: IDoctor, next: any) {\r\n  if (!this.isModified('password')) {\r\n    return;\r\n  }\r\n  const salt = await bcrypt.genSalt(10);\r\n  this.password = await bcrypt.hash(this.password, salt);\r\n});\r\n\r\n// Method to compare password\r\nDoctorSchema.methods.comparePassword = async function (enteredPassword: string) {\r\n  return await bcrypt.compare(enteredPassword, this.password);\r\n};\r\n\r\nexport default mongoose.models.Doctor || mongoose.model<IDoctor>('Doctor', DoctorSchema);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoBA,MAAM,eAAe,IAAI,mHAAM,CAC7B;IACE,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;IAChD;IACA,OAAO;QACL,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,OAAO;YAAC;YAAiD;SAA+B;IAC1F;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,WAAW;QACX,QAAQ;IACV;IACA,gBAAgB;QAAC;KAAO;IACxB,iBAAiB;QACf,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;IACA,qBAAqB;QACnB;YACE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,eAAe;QACb;YACE,KAAK;YACL,YAAY;YACZ,UAAU;QACZ;KACD;AACH,GACA;IACE,YAAY;AACd;AAGF,8BAA8B;AAC9B,aAAa,GAAG,CAAC,QAAQ,eAA+B,IAAS;IAC/D,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IACA,MAAM,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,oLAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;AACnD;AAEA,6BAA6B;AAC7B,aAAa,OAAO,CAAC,eAAe,GAAG,eAAgB,eAAuB;IAC5E,OAAO,MAAM,oLAAM,CAAC,OAAO,CAAC,iBAAiB,IAAI,CAAC,QAAQ;AAC5D;uCAEe,oHAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,oHAAQ,CAAC,KAAK,CAAU,UAAU"}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/app/api/auth/me/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getAuthUserFromRequest } from '@/lib/auth-request';\r\nimport { connectDB } from '@/lib/db/connection';\r\nimport Patient from '@/models/Patient';\r\nimport Doctor from '@/models/Doctor';\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const authUser = getAuthUserFromRequest(req);\r\n\r\n    if (!authUser) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    if (authUser.role === 'patient') {\r\n      const patient = await Patient.findById(authUser.id).lean();\r\n\r\n      if (!patient) {\r\n        return NextResponse.json(\r\n          { success: false, message: 'Patient not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        user: {\r\n          id: patient._id.toString(),\r\n          role: 'patient',\r\n          full_name: patient.full_name,\r\n          email: patient.email,\r\n          phone: patient.phone,\r\n        },\r\n      });\r\n    }\r\n\r\n    if (authUser.role === 'doctor') {\r\n      const doctor = await Doctor.findById(authUser.id).lean();\r\n\r\n      if (!doctor) {\r\n        return NextResponse.json(\r\n          { success: false, message: 'Doctor not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        user: {\r\n          id: doctor._id.toString(),\r\n          role: 'doctor',\r\n          full_name: doctor.full_name,\r\n          email: doctor.email,\r\n          specializations: doctor.specializations,\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { success: false, message: 'Unsupported role' },\r\n      { status: 400 }\r\n    );\r\n  } catch (error) {\r\n    console.error('[AUTH_ME_ERROR]', error);\r\n    return NextResponse.json(\r\n      { success: false, message: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,WAAW,IAAA,wLAAsB,EAAC;QAExC,IAAI,CAAC,UAAU;YACb,OAAO,sLAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAe,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,IAAA,4KAAS;QAEf,IAAI,SAAS,IAAI,KAAK,WAAW;YAC/B,MAAM,UAAU,MAAM,oKAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI;YAExD,IAAI,CAAC,SAAS;gBACZ,OAAO,sLAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,SAAS;gBAAoB,GAC/C;oBAAE,QAAQ;gBAAI;YAElB;YAEA,OAAO,sLAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM;oBACJ,IAAI,QAAQ,GAAG,CAAC,QAAQ;oBACxB,MAAM;oBACN,WAAW,QAAQ,SAAS;oBAC5B,OAAO,QAAQ,KAAK;oBACpB,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF;QAEA,IAAI,SAAS,IAAI,KAAK,UAAU;YAC9B,MAAM,SAAS,MAAM,mKAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI;YAEtD,IAAI,CAAC,QAAQ;gBACX,OAAO,sLAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,SAAS;gBAAmB,GAC9C;oBAAE,QAAQ;gBAAI;YAElB;YAEA,OAAO,sLAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM;oBACJ,IAAI,OAAO,GAAG,CAAC,QAAQ;oBACvB,MAAM;oBACN,WAAW,OAAO,SAAS;oBAC3B,OAAO,OAAO,KAAK;oBACnB,iBAAiB,OAAO,eAAe;gBACzC;YACF;QACF;QAEA,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAmB,GAC9C;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAwB,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}