{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/lib/db/connection.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/clinics-booking';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\nlet cached = global as any;\r\n\r\nif (!cached.mongoose) {\r\n  cached.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectDB() {\r\n  if (cached.mongoose.conn) {\r\n    return cached.mongoose.conn;\r\n  }\r\n\r\n  if (!cached.mongoose.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.mongoose.promise = mongoose\r\n      .connect(MONGODB_URI, opts)\r\n      .then((mongoose) => {\r\n        return mongoose;\r\n      });\r\n  }\r\n\r\n  try {\r\n    cached.mongoose.conn = await cached.mongoose.promise;\r\n  } catch (e) {\r\n    cached.mongoose.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.mongoose.conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI;AAEJ,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAChD;AAEO,eAAe;IACpB,IAAI,OAAO,QAAQ,CAAC,IAAI,EAAE;QACxB,OAAO,OAAO,QAAQ,CAAC,IAAI;IAC7B;IAEA,IAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,EAAE;QAC5B,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,QAAQ,CAAC,OAAO,GAAG,oHAAQ,CAC/B,OAAO,CAAC,aAAa,MACrB,IAAI,CAAC,CAAC;YACL,OAAO;QACT;IACJ;IAEA,IAAI;QACF,OAAO,QAAQ,CAAC,IAAI,GAAG,MAAM,OAAO,QAAQ,CAAC,OAAO;IACtD,EAAE,OAAO,GAAG;QACV,OAAO,QAAQ,CAAC,OAAO,GAAG;QAC1B,MAAM;IACR;IAEA,OAAO,OAAO,QAAQ,CAAC,IAAI;AAC7B"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/models/Slot.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface ISlot extends Document {\r\n  doctor_id: mongoose.Types.ObjectId;\r\n  clinic_id: mongoose.Types.ObjectId;\r\n  room_id: mongoose.Types.ObjectId;\r\n  date: Date;\r\n  time: string;\r\n  status: 'available' | 'booked';\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst SlotSchema = new Schema<ISlot>(\r\n  {\r\n    doctor_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Doctor',\r\n      required: true,\r\n    },\r\n    clinic_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Clinic',\r\n      required: true,\r\n    },\r\n    room_id: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Room',\r\n      required: true,\r\n    },\r\n    date: {\r\n      type: Date,\r\n      required: true,\r\n    },\r\n    time: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    status: {\r\n      type: String,\r\n      enum: ['available', 'booked'],\r\n      default: 'available',\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n);\r\n\r\n// Create compound index for faster availability searches\r\nSlotSchema.index({ doctor_id: 1, clinic_id: 1, date: 1, status: 1 });\r\n\r\nexport default mongoose.models.Slot || mongoose.model<ISlot>('Slot', SlotSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,WAAW;QACT,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,SAAS;QACP,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAa;SAAS;QAC7B,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,yDAAyD;AACzD,WAAW,KAAK,CAAC;IAAE,WAAW;IAAG,WAAW;IAAG,MAAM;IAAG,QAAQ;AAAE;uCAEnD,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/app/api/slots/available/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { connectDB } from '@/lib/db/connection';\r\nimport Slot from '@/models/Slot';\r\nimport Room from '@/models/Room';\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const { searchParams } = new URL(req.url);\r\n    const doctor_id = searchParams.get('doctor_id');\r\n    const clinic_id = searchParams.get('clinic_id');\r\n    const date = searchParams.get('date');\r\n\r\n    let query: any = { status: 'available' };\r\n\r\n    if (doctor_id) query.doctor_id = doctor_id;\r\n    if (clinic_id) query.clinic_id = clinic_id;\r\n\r\n    if (date) {\r\n      const startDate = new Date(date);\r\n      const endDate = new Date(date);\r\n      endDate.setDate(endDate.getDate() + 1);\r\n      query.date = { $gte: startDate, $lt: endDate };\r\n    }\r\n\r\n    const slots = await Slot.find(query)\r\n      .populate('room_id')\r\n      .lean();\r\n\r\n    return NextResponse.json(slots, { status: 200 });\r\n  } catch (error) {\r\n    console.error('Error fetching available slots:', error);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const { doctor_id, clinic_id, room_id, date, time } = await req.json();\r\n\r\n    if (!doctor_id || !clinic_id || !room_id || !date || !time) {\r\n      return NextResponse.json(\r\n        { error: 'Missing required fields' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const slot = await Slot.create({\r\n      doctor_id,\r\n      clinic_id,\r\n      room_id,\r\n      date: new Date(date),\r\n      time,\r\n      status: 'available',\r\n    });\r\n\r\n    return NextResponse.json(slot, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating slot:', error);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,IAAA,4KAAS;QACf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,QAAa;YAAE,QAAQ;QAAY;QAEvC,IAAI,WAAW,MAAM,SAAS,GAAG;QACjC,IAAI,WAAW,MAAM,SAAS,GAAG;QAEjC,IAAI,MAAM;YACR,MAAM,YAAY,IAAI,KAAK;YAC3B,MAAM,UAAU,IAAI,KAAK;YACzB,QAAQ,OAAO,CAAC,QAAQ,OAAO,KAAK;YACpC,MAAM,IAAI,GAAG;gBAAE,MAAM;gBAAW,KAAK;YAAQ;QAC/C;QAEA,MAAM,QAAQ,MAAM,iKAAI,CAAC,IAAI,CAAC,OAC3B,QAAQ,CAAC,WACT,IAAI;QAEP,OAAO,sLAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,IAAA,4KAAS;QACf,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEpE,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM;YAC1D,OAAO,sLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,iKAAI,CAAC,MAAM,CAAC;YAC7B;YACA;YACA;YACA,MAAM,IAAI,KAAK;YACf;YACA,QAAQ;QACV;QAEA,OAAO,sLAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ;QAAI;IAC/C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,sLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}