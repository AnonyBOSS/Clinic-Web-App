{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmad/Downloads/ClincsManagmentSystem/app/doctor/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ntype AuthUser = {\r\n  id: string;\r\n  role: \"doctor\" | \"patient\";\r\n  full_name: string;\r\n  email: string;\r\n};\r\n\r\ntype DoctorSchedule = {\r\n  day: string;\r\n  start_time: string;\r\n  end_time: string;\r\n};\r\n\r\ntype Appointment = {\r\n  _id: string;\r\n  createdAt: string;\r\n  status: string;\r\n  patient_id?: {\r\n    full_name: string;\r\n  };\r\n  clinic_id?: {\r\n    name: string;\r\n  };\r\n  room_id?: {\r\n    room_number: string;\r\n  };\r\n};\r\n\r\nexport default function DoctorDashboardPage() {\r\n  const router = useRouter();\r\n\r\n  const [user, setUser] = useState<AuthUser | null>(null);\r\n  const [schedule, setSchedule] = useState<DoctorSchedule[]>([]);\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\r\n  const [activeTab, setActiveTab] = useState<\"schedule\" | \"appointments\">(\r\n    \"schedule\"\r\n  );\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Helper to fetch dashboard data for a given date\r\n  const fetchDoctorData = async (date: string, cancelled?: boolean) => {\r\n    try {\r\n      setError(null);\r\n      const res = await fetch(`/api/doctor/dashboard?date=${date}`, {\r\n        method: \"GET\",\r\n        credentials: \"include\",\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (cancelled) return;\r\n\r\n      if (res.ok && data.success) {\r\n        setSchedule(data.schedule || []);\r\n        setAppointments(data.appointments || []);\r\n      } else {\r\n        console.error(\"Failed to load doctor data:\", data.message || data.error);\r\n        setError(data.message || data.error || \"Failed to load doctor data.\");\r\n      }\r\n    } catch (err) {\r\n      if (!cancelled) {\r\n        console.error(\"Error fetching doctor data:\", err);\r\n        setError(\"Failed to load doctor data.\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Initial auth + load\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const init = async () => {\r\n      try {\r\n        const res = await fetch(\"/api/auth/me\", {\r\n          method: \"GET\",\r\n          credentials: \"include\",\r\n        });\r\n\r\n        if (res.status === 401) {\r\n          if (!cancelled) router.push(\"/doctor/login\");\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n\r\n        if (!data.success || data.user.role !== \"doctor\") {\r\n          if (!cancelled) router.push(\"/doctor/login\");\r\n          return;\r\n        }\r\n\r\n        if (!cancelled) {\r\n          setUser(data.user);\r\n        }\r\n\r\n        const today = new Date().toISOString().split(\"T\")[0];\r\n        if (!cancelled) {\r\n          setSelectedDate(today);\r\n          await fetchDoctorData(today, cancelled);\r\n        }\r\n      } catch (err) {\r\n        if (!cancelled) {\r\n          console.error(\"Error loading doctor dashboard:\", err);\r\n          setError(\"Something went wrong loading your dashboard.\");\r\n        }\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    init();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [router]);\r\n\r\n  const handleDateChange = async (\r\n    e: React.ChangeEvent<HTMLInputElement>\r\n  ) => {\r\n    const date = e.target.value;\r\n    setSelectedDate(date);\r\n    await fetchDoctorData(date);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <main className=\"site-container py-10\">\r\n        <div className=\"card\">\r\n          <p>Loading your dashboard...</p>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <main className=\"site-container py-10\">\r\n        <div className=\"card\">\r\n          <h2 className=\"mb-2\">Something went wrong</h2>\r\n          <p className=\"mb-4 text-sm text-red-600\">{error}</p>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={() => router.refresh()}\r\n          >\r\n            Try again\r\n          </button>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    // Already redirected by effect; nothing to render\r\n    return null;\r\n  }\r\n\r\n  const firstName = user.full_name.split(\" \")[0];\r\n\r\n  return (\r\n    <main className=\"site-container py-10\">\r\n      {/* Header */}\r\n      <section className=\"mb-6\">\r\n        <h1 className=\"mb-1\">Welcome back, Dr. {firstName}</h1>\r\n        <p className=\"text-sm text-slate-500\">\r\n          Review your weekly schedule and today&apos;s appointments.\r\n        </p>\r\n      </section>\r\n\r\n      {/* Tabs */}\r\n      <section className=\"card mb-6\">\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setActiveTab(\"schedule\")}\r\n            className={`px-4 py-2 rounded-md text-sm font-medium ${\r\n              activeTab === \"schedule\"\r\n                ? \"bg-indigo-600 text-white\"\r\n                : \"bg-slate-100 text-slate-700\"\r\n            }`}\r\n          >\r\n            Weekly schedule\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setActiveTab(\"appointments\")}\r\n            className={`px-4 py-2 rounded-md text-sm font-medium ${\r\n              activeTab === \"appointments\"\r\n                ? \"bg-indigo-600 text-white\"\r\n                : \"bg-slate-100 text-slate-700\"\r\n            }`}\r\n          >\r\n            Appointments for {selectedDate || \"selected day\"}\r\n          </button>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Schedule tab */}\r\n      {activeTab === \"schedule\" && (\r\n        <section className=\"card\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Your weekly schedule</h2>\r\n          {schedule.length === 0 ? (\r\n            <p className=\"text-sm text-slate-500\">No schedule set yet.</p>\r\n          ) : (\r\n            <div className=\"grid gap-3 sm:grid-cols-2 md:grid-cols-3\">\r\n              {schedule.map((day, idx) => (\r\n                <div\r\n                  key={idx}\r\n                  className=\"soft-border rounded-lg bg-white p-4 flex flex-col gap-1\"\r\n                >\r\n                  <div className=\"font-medium text-slate-900\">{day.day}</div>\r\n                  <div className=\"text-sm text-slate-600\">\r\n                    {day.start_time} – {day.end_time}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <p className=\"mt-4 text-xs text-slate-400\">\r\n            Schedule management coming soon.\r\n          </p>\r\n        </section>\r\n      )}\r\n\r\n      {/* Appointments tab */}\r\n      {activeTab === \"appointments\" && (\r\n        <section className=\"card\">\r\n          <div className=\"flex items-center justify-between gap-3 mb-4\">\r\n            <div>\r\n              <h2 className=\"text-lg font-semibold\">Appointments</h2>\r\n              <p className=\"text-xs text-slate-500\">\r\n                Showing bookings for the selected date.\r\n              </p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <label\r\n                htmlFor=\"date\"\r\n                className=\"text-xs font-medium text-slate-600\"\r\n              >\r\n                Date\r\n              </label>\r\n              <input\r\n                id=\"date\"\r\n                type=\"date\"\r\n                value={selectedDate}\r\n                onChange={handleDateChange}\r\n                className=\"px-3 py-2 text-sm border rounded-md border-slate-200\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {appointments.length === 0 ? (\r\n            <p className=\"text-sm text-slate-500\">\r\n              No appointments scheduled for this date.\r\n            </p>\r\n          ) : (\r\n            <div className=\"table-wrapper\">\r\n              <table className=\"table-root\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Patient</th>\r\n                    <th>Clinic</th>\r\n                    <th>Room</th>\r\n                    <th>Status</th>\r\n                    <th>Created at</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {appointments.map((appt) => (\r\n                    <tr key={appt._id}>\r\n                      <td>{appt.patient_id?.full_name ?? \"—\"}</td>\r\n                      <td>{appt.clinic_id?.name ?? \"—\"}</td>\r\n                      <td>{appt.room_id?.room_number ?? \"—\"}</td>\r\n                      <td className=\"capitalize\">{appt.status}</td>\r\n                      <td>\r\n                        {new Date(appt.createdAt).toLocaleString(undefined, {\r\n                          dateStyle: \"short\",\r\n                          timeStyle: \"short\",\r\n                        })}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}